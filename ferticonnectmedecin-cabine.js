
= "Allemand") {
                  id17.innerHTML = "abmelden";
              }
              
              const id18 = document.getElementById("anulerdeco_neccterbtn");
              if (langue === "Français") {
                  id18.innerHTML = "fermer";
              } else if (langue === "Anglais") {
                  id18.innerHTML = "close";
              } else if (langue === "Espagnol") {
                  id18.innerHTML = "cerrar";
              } else if (langue === "Arabe") {
                  id18.innerHTML = "إغلاق";
              } else if (langue === "Portugais") {
                  id18.innerHTML = "fechar";
              } else if (langue === "Allemand") {
                  id18.innerHTML = "schließen";
    
                  id19.innerHTML = "Kommentare";
              }
              
              const id20 = document.getElementById("MLIDCDVC");
              if (langue === "Français") {
                  id20.innerHTML = "Modifiez l'image de couverture du votre cabine";
              } else if (langue === "Anglais") {
                  id20.innerHTML = "Modify the cover image of your office";
              } else if (langue === "Espagnol") {
                  id20.innerHTML = "Modificar la imagen de portada de tu oficina";
              } else if (langue === "Arabe") {
                  id20.innerHTML = "تعديل صورة غلاف مكتبك";
              } else if (langue === "Portugais") {
                  id20.innerHTML = "Modifique a imagem de capa do seu escritório";
              } else if (langue === "Allemand") {
                  id20.innerHTML = "Ändern Sie das Titelbild Ihres Büros";
              }
              
              const id21 = document.getElementById("Partager3");
              if (langue === "Français") {
                  id21.innerHTML = "Partager";
              } else if (langue === "Anglais") {
                  id21.innerHTML = "Share";
              } else if (langue === "Espagnol") {
                  id21.innerHTML = "Compartir";
              } else if (langue === "Arabe") {
                  id21.innerHTML = "مشاركة";
              } else if (langue === "Portugais") {
                  id21.innerHTML = "Compartilhar";
              } else if (langue === "Allemand") {
                  id21.innerHTML = "Teilen";
              }
              
              const id22 = document.getElementById("termin4");
              if (langue === "Français") {
                  id22.innerHTML = "terminée";
              } else if (langue === "Anglais") {
                  id22.innerHTML = "completed";
              } else if (langue === "Espagnol") {
                  id22.innerHTML = "terminada";
              } else if (langue === "Arabe") {
                  id22.innerHTML = "مكتمل";
              } else if (langue === "Portugais") {
                  id22.innerHTML = "concluída";
              } else if (langue === "Allemand") {
                  id22.innerHTML = "abgeschlossen";
              }
              
              const id23 = document.getElementById("fermer4");
              if (langue === "Français") {
                  id23.innerHTML = "fermer";
              } else if (langue === "Anglais") {
                  id23.innerHTML = "close";
              } else if (langue === "Espagnol") {
                  id23.innerHTML = "cerrar";
              } else if (langue === "Arabe") {
                  id23.innerHTML = "إغلاق";
              } else if (langue === "Portugais") {
                  id23.innerHTML = "fechar";
              } else if (langue === "Allemand") {
                  id23.innerHTML = "schließen";
              }
              

              
              const input1 = document.getElementById("inputpubadd");
              if (langue === "Français") {
                  input1.placeholder = "Quoi de neuf ?";
              } else if (langue === "Anglais") {
                  input1.placeholder = "What's new?";
              } else if (langue === "Espagnol") {
                  input1.placeholder = "¿Qué hay de nuevo?";
              } else if (langue === "Arabe") {
                  input1.placeholder = "ما الجديد؟";
              } else if (langue === "Portugais") {
                  input1.placeholder = "O que há de novo?";
              } else if (langue === "Allemand") {
                  input1.placeholder = "Was gibt's Neues?";
                }
              const input2 = document.getElementById("inputpubadd_comment");
              if (langue === "Français") {
                  input2.placeholder = "Ajouter un commentaire ?";
              } else if (langue === "Anglais") {
                  input2.placeholder = "Add a comment?";
              } else if (langue === "Espagnol") {
                  input2.placeholder = "¿Agregar un comentario?";
              } else if (langue === "Arabe") {
                  input2.placeholder = "إضافة تعليق؟";
              } else if (langue === "Portugais") {
                  input2.placeholder = "Adicionar um comentário?";
              } else if (langue === "Allemand") {
                  input2.placeholder = "Einen Kommentar hinzufügen?";
                }
              const input3 = document.getElementById("inputpubadd_comment");
              if (langue === "Français") {
                  input3.placeholder = "Ajouter un commentaire ?";
              } else if (langue === "Anglais") {
                  input3.placeholder = "Add a comment?";
              } else if (langue === "Espagnol") {
                  input3.placeholder = "¿Agregar un comentario?";
              } else if (langue === "Arabe") {
                  input3.placeholder = "إضافة تعليق؟";
              } else if (langue === "Portugais") {
                  input3.placeholder = "Adicionar um comentário?";
              } else if (langue === "Allemand") {
                  input3.placeholder = "Einen Kommentar hinzufügen?";
               }  

               const input4 = document.getElementById("inputpubadd_comment");
               if (langue === "Français") {
                input4.placeholder = "Ajouter un commentaire ?";
               } else if (langue === "Anglais") {
                input4.placeholder = "Add a comment?";
               } else if (langue === "Espagnol") {
                   input4.placeholder = "¿Agregar un comentario?";
               } else if (langue === "Arabe") {
                   input4.placeholder = "إضافة تعليق؟";
               } else if (langue === "Portugais") {
                   input4.placeholder = "Adicionar um comentário?";
               } else if (langue === "Allemand") {
                   input4.placeholder = "Einen Kommentar hinzufügen?";
                  } 
               

               

               


                 
            }  
      
       }catch(error){
 
       }
    }
});


//const couvertureCabine = document.getElementById("messageAjoutePhoto");

const messageAjoutePhoto = document.getElementById("messageAjoutePhoto");
//messageAjoutePhoto.style.cursor="pointer";
const photochanger_couverture_i = document.getElementById("photochanger_couverture_i");
const nouveauimage_couv = document.getElementById("nouveauimage_couv");
const fermer2 = document.getElementById("fermer2");
const partagerphotoPbtn_couv = document.getElementById("partagerphotoPbtn_couv");
const Done_couv = document.getElementById("Done_couv");
const loader_couv = document.getElementById("loader_couv");
const original_couv = document.getElementById("original_couv");

const photocouverturechangerbg = document.getElementById("photocouverturechangerbg");
messageAjoutePhoto.addEventListener("click", async (e) => {
    e.preventDefault();
    photocouverturechangerbg.style.display="flex";

});
fermer2.addEventListener('click', function() {
    photocouverturechangerbg.style.display="none"
});
let file3;
document.getElementById('photochanger_couverture').addEventListener('click', function() {
    var input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    input.id = "fileInput1";
    input.onchange = function(e) {
        file3 = e.target.files[0];
        var reader = new FileReader();
        reader.readAsDataURL(file3);
        reader.onload = function() {
            const imageUrl = reader.result;
            photochanger_couverture_i.style.display = "none";
            nouveauimage_couv.style.display = "flex";
            partagerphotoPbtn_couv.style.display = "block";
            nouveauimage_couv.innerHTML = "";

            // Affichage de l'image dans la galerie
            const img = document.createElement('img');
            img.src = imageUrl;
            nouveauimage_couv.appendChild(img);
        };
    };
    input.click();
});

partagerphotoPbtn_couv.addEventListener('click', async function() {
    original_couv.style.display = "none";
    loader_couv.style.display = "block";
    loader_couv.style.color="white";

    if (file3) {
        try {
            // Upload des images dans le stockage Firebase
            const storageRef2 = storageRef(storage, 'images/' + file3.name);
            await uploadBytes(storageRef2, file3);
            const downloadURL2 = await getDownloadURL(storageRef2);
            const userDocRef = doc(db, "cabines", IdCabine);
            await updateDoc(userDocRef, {
                cabineImage: downloadURL2,
            });
            original_couv.style.display = "none";
            loader_couv.style.display = "none";
            Done_couv.style.display = "block";
            refreshPage();
        } catch (error) {
            console.error(error);
            original_couv.style.display = "block";
            loader_couv.style.display = "none";
            Done_couv.style.display = "none";

        }
    }
});







const sendImageicon = document.getElementById('sendImageicon');
const messageecrit = document.getElementById('messageecrit');
const sendmessageicon = document.getElementById('sendmessageicon');
const QMPEUM_ = document.getElementById('QMPEUM');


const docRef_info_cab = doc(db, "cabines", IdCabine);
try {
    const docSnap = await getDoc(docRef_info_cab); // Récupération du snapshot du document
    const datacabine = docSnap.data(); // Récupération des données du document cabine
    const cabineImage = datacabine.cabineImage;
    const creatorId = datacabine.creatorId;
    const nameCabine = datacabine.nameCabine;

    const name_room_message = document.getElementById("name_room_message");
    name_room_message.innerHTML= nameCabine;
    const Image_header_message = document.getElementById("Image_header_message");
    const Image_header_message_img = document.createElement("img");

                                        }
                                        else{
                                            hedercomment_h1.innerHTML = nameuser + " " + prenameuser;
                                            hedercomment_img_img.src = imguser ? imguser : "img/ferticonnectiLogoWhite.svg";
    
    
                                        }
                                    }
                                    else{
                                        hedercomment_h1.innerHTML = nameuser + " " + prenameuser;
                                        hedercomment_img_img.src = imguser ? imguser : "img/ferticonnectiLogoWhite.svg";
    
    
                                    }
                        
                                    hedercomment_img.appendChild(hedercomment_img_img);
                                    hedercomment.appendChild(hedercomment_img);
                                    hedercomment.appendChild(hedercomment_h1);
                                    hedercomment.appendChild(hedercomment_i);
                                    content_comment.appendChild(content_comment_p);
                                    comment_listeComments_bg.appendChild(hedercomment);
                                    comment_listeComments_bg.appendChild(content_comment);
                                    listeComments_bg_list.appendChild(comment_listeComments_bg);
    
                                }
    
    
                            } catch (error) {
                                console.error("Une erreur s'est produite lors de l'importation des informations utilisateur :", error);
                            }
                        }
                        
    
                        send_comment.onclick = send_commentFunction;
    
                        async function send_commentFunction(){
                            sharePublicationComment();
                            numbercommentaires();
                        }
                        
                        async function sharePublicationComment() {
                            wating.style.display = "flex";
                            auth.onAuthStateChanged(async(user) => {
                                if (user) {
                                    const userId = user.uid;
                                        try {
                                            const inputpubadd_comment = document.getElementById("inputpubadd_comment").value;
                                            const docRef = await addDoc(collection(db, "publications", idpub, "commentaires"), {
                                                commentaires: inputpubadd_comment,
                                                iduser_comment: userId,
                                                typeuser: typeOfUser,
                                                timestamp: serverTimestamp()
                                            });
    
                                            wating.style.display = "none";
                                            const inputpubadd_comme = document.getElementById("inputpubadd_comment");
                                            inputpubadd_comme.value="";
    
                                            AficherLesCommentaire();
    
    
                                        } catch (error) {
                                            console.error(error);
                                            wating.style.display = "none";
                                            //message_cree_produit.innerHTML = 'Erreur lors du partage du produit: ' + error.message;
                                        }
                                }
                            });
                        }
                        
                    }
    
                    btncomment.appendChild(btncomment_i);
                    jaimecommentbtns.appendChild(btncomment);
                    pubbg_.appendChild(jaimecommentbtns);
    
                    const user = auth.currentUser;
                    if (user) {
                        const userId = user.uid;                      
                          const docRef = collection(db, 'publications', idpub, 'jaimes');
                          const querySnapshot = await getDocs(docRef);
                          querySnapshot.forEach((doc) => {
                              const data = doc.data();
                              const userjaimeid = data.iduser;
    
                              if (userjaimeid === userId) {
                                  btnjaimei1.style.display = "none";
                                  btnjaimei2.style.display = "flex";
                              } 
                          });
                      
                    }
                    btnjaime.addEventListener("click", async (e) => {
                        e.preventDefault();
                        const user = auth.currentUser;
                        if (user) {
                            const userId = user.uid;
                            if (btnjaimei1.style.display === "none") {
                                btnjaimei1.style.display = "flex";
                                btnjaimei2.style.display = "none";
                            
                                const jaimesCollectionRef = collection(db, 'publications', idpub, 'jaimes');
                                try {
                                    const querySnapshot = await getDocs(query(jaimesCollectionRef, where("iduser", "==", userId)));
                                
                                    // Parcourir les documents correspondants
                                    querySnapshot.forEach(async (doc) => {
                                        try {
                                            console.log("Document trouvé :", doc.id);
                                            // Supprimer le document
                                            await deleteDoc(doc.ref);
                                            // Mettre à jour le nombre de "j'aime" après la suppression
                                            await numberjaime();
                                        } catch (error) {
                                            console.error("Erreur lors de la suppression du document de la sous-collection 'jaimes':", error);
                                        }
                                    });
                                } catch (error) {
                                    console.error("Erreur lors de la récupération des documents de la sous-collection 'jaimes':", error);
                                }
                                
                            } else {
                                btnjaimei1.style.display = "none";
                                btnjaimei2.style.display = "flex";
                                const docRef = await addDoc(collection(db, 'publications',idpub,'jaimes'), {
                                    iduser:userId,
                                });
                                numberjaime();
                            }
                        } else {
                            console.log("L'utilisateur n'est pas connecté.");
                        }
                    });
    
    
                }
                else(
                    console.log("vide")
                )
            
        } catch (error) {
            console.error("Erreur lors de la récupération des données utilisateur:", error);
        }
    
        
    }


    
    const partagerntn = document.getElementById("partagerntn");
    //const fileInput1 = document.getElementById("fileInput1");
    const inputpubadd = document.getElementById("inputpubadd").value;
    const imagge1 = document.getElementById("imagge1");
    const gallery1 = document.getElementById("gallery1");
    const wating = document.getElementById("wating");
    let file
    document.getElementById('importphoto').addEventListener('click', function() {
        var input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.id = "fileInput1";
        input.onchange = function(e) {
            file = e.target.files[0];
            var reader = new FileReader();
            reader.readAsDataURL(file);
    
            reader.onload = function() {
                const imageUrl = reader.result;
                gallery1.style.display = "flex";
                imagge1.innerHTML = "";
    
                // Affichage de l'image dans la galerie
                const img = document.createElement('img');
                img.src = imageUrl;
                imagge1.appendChild(img);
            };
        };
        input.click();
    });
    
    partagerntn.addEventListener("click", async(e) => {
        e.preventDefault();
        sharePublication(file);
    });


     async function sharePublication(file) {
         wating.style.display = "flex";
         auth.onAuthStateChanged(async(user) => {
             if (user) {
                 const userId = user.uid;
                 if (file) {
                     try {

                         // Upload des images dans le stockage Firebase
                         const storageRef1 = storageRef(storage, 'images/' + file.name);
                         await uploadBytes(storageRef1, file);
                         const downloadURL1 = await getDownloadURL(storageRef1);
                         const inputpubadd = document.getElementById("inputpubadd").value;

                         const docRef = await addDoc(collection(db, 'publications'), {
                             publication: inputpubadd,
                             imageUrl_publication: downloadURL1,
                             iduser: userId,
                             placepub: "cabine",
                             typeuser: typeuserclick,
                             timestamp: firestoreServerTimestamp()
                         });
                         const docRefadmin = await addDoc(collection(db, 'cabines',IdCabine,"publications"), {
                             publicationCabine_id: docRef.id,
                             timestamp: firestoreServerTimestamp()

                         });
                         
                         wating.style.display = "none";
                         refreshPage();
                     } catch (error) {
                         console.error(error);
                         wating.style.display = "none";
                         //message_cree_produit.innerHTML = 'Erreur lors du partage du produit: ' + error.message;
                     }
                 } else {
                     try {
                         const inputpubadd = document.getElementById("inputpubadd").value;
                         // Upload des images dans le stockage Firebase
                         const docRef = await addDoc(collection(db, 'publications'), {
                             publication: inputpubadd,
                             iduser: userId,
                             placepub: "cabine",
                             timestamp: firestoreServerTimestamp(),
                             typeuser: typeuserclick
                         });
                         const docRefadmin = await addDoc(collection(db, 'cabines',IdCabine,"publications"), {
                            publicationCabine_id: docRef.id,
                            timestamp: firestoreServerTimestamp()
                        });
                        
                         wating.style.display = "none";
                         refreshPage();
     
                     } catch (error) {
                         console.error(error);
                         wating.style.display = "none";
     
                         //message_cree_produit.innerHTML = 'Erreur lors du partage du produit: ' + error.message;
                     }
                 }
             }
         });
     }
     
         
     
     
} catch (error) {
  console.error("Erreur lors de la récupération des données de la cabine :", error);
}


if(typeOfUser==="medecin"){
    const veri_acco = document.getElementById("veri_acco");
    veri_acco.style.display="flex";
}
else{
    const veri_acco = document.getElementById("veri_acco");
    veri_acco.style.display="none";
}

  auth.onAuthStateChanged(async (user) => {
    if (user) {
        // Récupération de l'adresse e-mail de l'utilisateur connecté
        const mail = user.email;
        const userId = user.uid;
        const userRef = doc(db, typeuserclick, userId);
        const docSnapshot = await getDoc(userRef);
        
        if (docSnapshot.exists()) {
            const photoprofilepubadd = document.getElementById("photoprofilepubadd");
            const photoprofilepubadd1 = document.getElementById("photoprofilepubadd1");
            const imguser = docSnapshot.data().imguser;
            if(imguser){
                photoprofilepubadd.src=imguser;
                photoprofilepubadd1.src=imguser;
                  photoprofilepubadd.addEventListener('click', () => {
                       window.location.href = `ferticonnectmedecin-profilepage.html?useridclick=${userId}&typeuserclick=${typeuserclick}&typeOfUser=${typeOfUser}`; // Redirection vers la page du produit avec l'ID du produit
                  }); 
                  photoprofilepubadd1.addEventListener('click', () => {
                       window.location.href = `ferticonnectmedecin-profilepage.html?useridclick=${userId}&typeuserclick=${typeuserclick}&typeOfUser=${typeOfUser}`; // Redirection vers la page du produit avec l'ID du produit
                  }); 
            }

        }
        const profilinfobg = document.getElementById("profilinfobg");
        profilinfobg.addEventListener('click', () => {
            window.location.href = `ferticonnectmedecin-profilepage.html?useridclick=${userId}&typeuserclick=${typeuserclick}&typeOfUser=${typeOfUser}`; // Redirection vers la page du produit avec l'ID du produit
        }); 

        const amisquerySnapshot = await getDocs(query(collection(db, typeOfUser,userId,"amis")));
        amisquerySnapshot.forEach((doc) => {
            const data = doc.data();
            const iduseramis = data.iduser;
            const typeuseramis = data.typeuser;
            recupereAmis(iduseramis,typeuseramis);

        });
        async function recupereAmis(iduseramis,typeuseramis){
            const docRef = doc(db, typeuseramis, iduseramis);
            const docSnap = await getDoc(docRef); 
            const datauser = docSnap.data(); 
            
            const nameuser = datauser.nom;
            const prenameuser = datauser.prenom;
            const imguser = datauser.imguser;
            const type_user = datauser.typeOfUser;
            
            const cabinfoss = document.createElement('div');
            cabinfoss.className="cabinfoss";

            const mescabins_image = document.createElement('div');
            mescabins_image.className="mescabins_image";

            const mescabins_image_img = document.createElement('img');
            if(imguser){
                mescabins_image_img.src=imguser;
            }else{
                mescabins_image_img.src="img/ferticonnectiLogoWhite.svg";
            }
            const mescabins_name = document.createElement('div');
            mescabins_name.className="mescabins_name";

            const mescabins_nameh1 = document.createElement('h1');
            mescabins_nameh1.innerHTML=prenameuser+" "+nameuser;

            mescabins_image.appendChild(mescabins_image_img);
            cabinfoss.appendChild(mescabins_image);
            mescabins_name.appendChild(mescabins_nameh1);
            cabinfoss.appendChild(mescabins_name);
            mescabins_2.appendChild(cabinfoss);

            cabinfoss.addEventListener('click', () => {
                window.location.href = `ferticonnectmedecin-profilepage.html?useridclick=${iduseramis}&typeuserclick=${typeuseramis}&typeOfUser=${typeOfUser}`; // Redirection vers la page du produit avec l'ID du produit
            }); 
        }


        const cabinequerySnapshot = await getDocs(query(collection(db, typeOfUser,userId,"cabines")));
        cabinequerySnapshot.forEach((doc) => {
            const data = doc.data();
            const cabineId = data.cabineId;
            recupereCabine(cabineId);

        });
        async function recupereCabine(cabineId){
            const docRef = doc(db, "cabines", cabineId);
            const docSnap = await getDoc(docRef); 
            const dataCabine = docSnap.data(); 
            const nameCabine = dataCabine.nameCabine;
            const cabine_Image = dataCabine.cabineImage;
            const creator_Id = dataCabine.creatorId;
            
            const cabinfoss = document.createElement('div');
            cabinfoss.className="cabinfoss";

            const mescabins_image = document.createElement('div');
            mescabins_image.className="mescabins_image";

            const mescabins_image_img = document.createElement('img');
            if(cabine_Image){
                mescabins_image_img.src=cabine_Image;
            }else{
                mescabins_image_img.src="img/ferticonnectiLogoWhite.svg";
            }
            const mescabins_name = document.createElement('div');
            mescabins_name.className="mescabins_name";

            const mescabins_nameh1 = document.createElement('h1');
            mescabins_nameh1.innerHTML= nameCabine;

            mescabins_image.appendChild(mescabins_image_img);
            cabinfoss.appendChild(mescabins_image);
            mescabins_name.appendChild(mescabins_nameh1);
            cabinfoss.appendChild(mescabins_name);
            mescabins_.appendChild(cabinfoss);

            cabinfoss.addEventListener('click', () => {
                window.location.href = `ferticonnectmedecin-cabine.html?cabineidclick=${cabineId}&typeOfUser=${typeOfUser}`; // Redirection vers la page du produit avec l'ID du produit
            }); 
        }
        
        

        



        // Vérification si l'e-mail existe dans la collection "admins"
        const q = query(collection(db, typeuserclick), where("email", "==", mail));

        try {
            const querySnapshot = await getDocs(q);
            if (!querySnapshot.empty) {
                const watingAccount = document.getElementById("wating");
                watingAccount.style.display = "flex";

                const userId = user.uid;
                const userRef = doc(db, typeuserclick, userId);
                const docSnapshot = await getDoc(userRef);


                if (docSnapshot.exists()) {
                    // Correction : récupération de l'e-mail depuis docSnapshot.data()
                    const statut_du_compte = docSnapshot.data().statut_du_compte;
                    const nomAdm = docSnapshot.data().nom;
                    const prenomAdm = docSnapshot.data().prenom;

                    const nom_prenom_admin = document.getElementById("nameUser_connect");
                    nom_prenom_admin.innerHTML = prenomAdm.toUpperCase() + " " + nomAdm.toUpperCase();

                    if (statut_du_compte === "desactive") {
                        window.location.href = 'index.html';
                    } else {
                        watingAccount.style.display = "none";
                    }
                    watingAccount.style.display = "none";

                }
            } else {
                console.log("déconnection en cours ...")
                logout();
            }
        } catch (error) {
            console.error("Erreur lors de la vérification du email :", error);
        }
    } else {
        window.location.href = 'index.html';
    }
});

const deconnectionbg = document.getElementById("deconnectionbg");

const loggouut_nav = document.getElementById("loggouut_nav");
loggouut_nav.addEventListener("click", async (e) => {
    e.preventDefault();
    deconnectionbg.style.display="flex";
});

const anulerdeco_neccterbtn = document.getElementById("anulerdeco_neccterbtn");
anulerdeco_neccterbtn.addEventListener("click", async (e) => {
    e.preventDefault();
    deconnectionbg.style.display="none";
});
const deco_neccterbtn = document.getElementById("deco_neccterbtn");
deco_neccterbtn.addEventListener("click", async (e) => {
    e.preventDefault();
    logout();
});

// Fonction de déconnexion
function logout() {
    signOut(auth).then(() => {
        window.location.href = 'index.html'; 
    }).catch((error) => {
        console.error('Erreur lors de la déconnexion : ', error);
    });
}




// Recharge la page actuelle
function refreshPage() {
    window.location.reload(); 
}

